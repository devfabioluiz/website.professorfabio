<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aula 5 - Express.js</title>
    <link rel="stylesheet" href="../../estilos/estilos-aulas.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  </head>

  <body>
    <header>
      <h1>Aula 5</h1>
      <h4 class="text-center">Node.js</h4>
      <h4 class="text-center">Framework Express</h4>
    </header>

    <div class="container">
      <h2>Introdução ao Express</h2>
      <section>
        <p>
          Express.js é um framework minimalista para Node.js que facilita a
          criação de servidores web e APIs REST. Ele abstrai a complexidade do
          módulo HTTP nativo, oferecendo uma API simples, poderosa e altamente
          extensível.
        </p>
      </section>

      <h2>Instalação e Configuração</h2>
      <section>
        <div>
          <pre>
<code class="language-bash">
npm init -y
npm install express
</code>
          </pre>
        </div>

        <div>
          <pre>
<code class="language-javascript">
const express = require("express");
const app = express();

app.listen(3000, () => {
  console.log("Servidor rodando em http://localhost:3000");
});
</code>
          </pre>
        </div>
      </section>

      <h2>Request e Response</h2>
      <section>
        <div>
          <pre>
<code class="language-javascript">
app.get("/", (req, res) => {
  res.send("Hello Express");
});

app.post("/dados", (req, res) => {
  res.json({ status: "ok" });
});
</code>
          </pre>
        </div>
      </section>

      <h2>Roteamento</h2>
      <section>
        <div>
          <pre>
<code class="language-javascript">
const router = require("express").Router();

router.get("/users", (req, res) => {
  res.send("Lista de usuários");
});

module.exports = router;
</code>
          </pre>
        </div>
      </section>

      <h2>Arquivos Estáticos</h2>
      <section>
        <div>
          <pre>
<code class="language-javascript">
app.use(express.static("public"));
</code>
          </pre>
        </div>
      </section>

      <h2>Manipulação de Formulários</h2>
      <section>
        <div>
          <pre>
<code class="language-javascript">
app.use(express.urlencoded({ extended: true }));

app.post("/form", (req, res) => {
  res.send(req.body);
});
</code>
          </pre>
        </div>
      </section>

      <h2>Upload de Arquivos</h2>
      <section>
        <div>
          <pre>
<code class="language-bash">
npm install multer
</code>
          </pre>
        </div>

        <div>
          <pre>
<code class="language-javascript">
const multer = require("multer");

const upload = multer({ dest: "uploads/" });

app.post("/upload", upload.single("file"), (req, res) => {
  res.send("Arquivo enviado!");
});
</code>
          </pre>
        </div>
      </section>

      <h2>Cookies e Sessões</h2>
      <section>
        <div>
          <pre>
<code class="language-bash">
npm install express-session cookie-parser
</code>
          </pre>
        </div>

        <div>
          <pre>
<code class="language-javascript">
const session = require("express-session");
const cookieParser = require("cookie-parser");

app.use(cookieParser());
app.use(session({
  secret: "segredo",
  resave: false,
  saveUninitialized: true
}));

app.get("/login", (req, res) => {
  req.session.user = "Fabio";
  res.send("Sessão criada");
});
</code>
          </pre>
        </div>
      </section>

      <h2>Integração com PostgreSQL</h2>
      <section>
        <div>
          <pre>
<code class="language-bash">
npm install pg
</code>
          </pre>
        </div>

        <div>
          <pre>
<code class="language-javascript">
const { Pool } = require("pg");

const pool = new Pool({
  host: "localhost",
  user: "postgres",
  password: "123456",
  database: "node_db",
  port: 5432
});

app.get("/users", async (req, res) => {
  const result = await pool.query("SELECT * FROM users");
  res.json(result.rows);
});
</code>
          </pre>
        </div>
      </section>

      <h2>Exemplo Prático - API CRUD Completa</h2>
      <section>
        <p>Exemplo simples de CRUD:</p>

        <div>
          <pre>
<code class="language-javascript">
app.post("/users", async (req, res) => {
  const { nome, email } = req.body;
  await pool.query(
    "INSERT INTO users (nome, email) VALUES ($1, $2)",
    [nome, email]
  );
  res.sendStatus(201);
});

app.get("/users", async (req, res) => {
  const result = await pool.query("SELECT * FROM users");
  res.json(result.rows);
});

app.put("/users/:id", async (req, res) => {
  const { id } = req.params;
  const { nome, email } = req.body;
  await pool.query(
    "UPDATE users SET nome=$1, email=$2 WHERE id=$3",
    [nome, email, id]
  );
  res.sendStatus(200);
});

app.delete("/users/:id", async (req, res) => {
  const { id } = req.params;
  await pool.query("DELETE FROM users WHERE id=$1", [id]);
  res.sendStatus(204);
});
</code>
          </pre>
        </div>
      </section>
    </div>

    <footer>
      <div class="button-container">
        <button class="btn-print" onclick="window.print()">Imprimir</button>
      </div>
      <div class="button-container">
        <a class="btn-indice" href="../indice-step.html">Ir para o índice</a>
      </div>
    </footer>

    <script src="../../scripts/copy-clipboard.js"></script>
  </body>
</html>
